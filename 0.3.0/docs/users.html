
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2016-02-18
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Time Series for Spark &#x2013; User Guide</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="../css/bootswatch.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />


		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-docs-users project-sparkts" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html">Time Series for Spark</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../index.html" title="Overview">Overview</a></li>
							<li class="active"><a href="" title="Docs: Users">Docs: Users</a></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="page-header">
 <h1 id="user_guide">User Guide</h1>
</div> 
<div class="section"> 
 <h2 id="Terminology">Terminology</h2> 
 <p>A variety of terms are used to describe time series data, and many of these apply to conflicting or overlapping concepts. In the interest of clarity, we stick to the following set of definitions:</p> 
 <ul> 
  <li><b>Time Series</b> - A sequence of floating point values, each linked to a timestamp. In particular, we try to stick with “time series” as meaning a univariate time series, although in other contexts it sometimes refers to series with multiple values at the same timestamp. A notable instance of the latter is the <tt>TimeSeries</tt> class, which refers to a multivariate time series. In Scala, a time series is usually represented by a Breeze vector, and in Python, a 1-D numpy array, and has a DateTimeIndex somewhere nearby to link its values to points in time.</li> 
  <li><b>Key</b> - A string label used to identify a time series. A TimeSeriesRDD is a distributed collection of tuples of (key, time series)</li> 
  <li><b>Instant</b> - The set of values in a collection of time series corresponding to a single point in time.</li> 
  <li><b>Observation</b> - A tuple of (timestamp, key, value).</li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="Laying_Out_Time_Series_Data">Laying Out Time Series Data</h2> 
 <p>The layout of a time-series data set determines what questions are easy to ask about it and how quickly the answers to those questions can be computed. In Spark, we work with RDDs, DataFrames, and Datasets, which are all collections of objects partitioned across a set of machines in the cluster. Thus when choosing the layout of a data set, the most important question is “What data do we store in each of these objects?” Using “observations”, “instants”, or “time series”, as defined above, gives rise to three complementary layouts.</p> 
 <p>Most analysis starts out with taking data that has been compiled in a table of observations or instants and formatting it into a table of time series. The <tt>spark-ts</tt> package provides the <tt>TimeSeriesRDD</tt> data structure for dealing with data in a time series layout, as well as functionality for moving data into this layout from other layouts. </p> 
 <p>Here’s an example of data in an observations layout:</p> 
 <table border="0" class="bodyTable table table-striped table-hover"> 
  <thead> 
   <tr class="a"> 
    <th>Timestamp </th> 
    <th>Key </th> 
    <th>Value </th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr class="b"> 
    <td>5:00 PM </td> 
    <td>GOOG </td> 
    <td>$523 </td> 
   </tr> 
   <tr class="a"> 
    <td>6:00 PM </td> 
    <td>GOOG </td> 
    <td> </td> 
   </tr> 
   <tr class="b"> 
    <td>7:00 PM </td> 
    <td>GOOG </td> 
    <td>$524 </td> 
   </tr> 
   <tr class="a"> 
    <td>8:00 PM </td> 
    <td>GOOG </td> 
    <td>$600 </td> 
   </tr> 
   <tr class="b"> 
    <td>5:00 PM </td> 
    <td>AAPL </td> 
    <td>$384 </td> 
   </tr> 
   <tr class="a"> 
    <td>6:00 PM </td> 
    <td>AAPL </td> 
    <td>$384 </td> 
   </tr> 
   <tr class="b"> 
    <td>7:00 PM </td> 
    <td>AAPL </td> 
    <td>$385 </td> 
   </tr> 
   <tr class="a"> 
    <td>8:00 PM </td> 
    <td>AAPL </td> 
    <td>$385 </td> 
   </tr> 
   <tr class="b"> 
    <td>5:00 PM </td> 
    <td>MSFT </td> 
    <td>$40 </td> 
   </tr> 
   <tr class="a"> 
    <td>6:00 PM </td> 
    <td>MSFT </td> 
    <td>$60 </td> 
   </tr> 
   <tr class="b"> 
    <td>7:00 PM </td> 
    <td>MSFT </td> 
    <td> </td> 
   </tr> 
   <tr class="a"> 
    <td>8:00 PM </td> 
    <td>MSFT </td> 
    <td>$70 </td> 
   </tr> 
  </tbody> 
 </table> 
 <p>An advantage of this layout is that one can append data without needing the full vector of values at a particular timestamp — each row only includes a single scalar value. There’s also no need to worry about changing the schema when one adds more keys..</p> 
 <p>However, the observations layout is not ideal for performing analysis. To ask most questions, one needs to perform a group by on your data set, either by key or by timestamp, which is cumbersome as well as computationally expensive.</p> 
 <p>Here’s an example of data in an instants layout:</p> 
 <table border="0" class="bodyTable table table-striped table-hover"> 
  <thead> 
   <tr class="a"> 
    <th>Timestamp </th> 
    <th>GOOG </th> 
    <th>AAPL </th> 
    <th>MSFT </th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr class="b"> 
    <td>5:00 PM </td> 
    <td>$523 </td> 
    <td>$384 </td> 
    <td>$40 </td> 
   </tr> 
   <tr class="a"> 
    <td>6:00 PM </td> 
    <td> </td> 
    <td>$384 </td> 
    <td>$60 </td> 
   </tr> 
   <tr class="b"> 
    <td>7:00 PM </td> 
    <td>$524 </td> 
    <td>$385 </td> 
    <td> </td> 
   </tr> 
   <tr class="a"> 
    <td>8:00 PM </td> 
    <td>$600 </td> 
    <td>$385 </td> 
    <td>$70 </td> 
   </tr> 
  </tbody> 
 </table> 
 <p>The “instants” layout is ideal for much of traditional machine learning — for example, building a supervised learning model that predicts one variable based on contemporaneous values of the others. However, it’s not sufficient for operations that need to look at full series - for example imputing missing values based on their temporal predecessors or fitting ARIMA models.</p> 
 <p>Ideal for this is the time series layout:</p> 
 <p><b>Date-time index: [5:00 PM, 6:00 PM, 7:00 PM, 8:00 PM]</b></p> 
 <table border="0" class="bodyTable table table-striped table-hover"> 
  <thead> 
   <tr class="a"> 
    <th>Key </th> 
    <th>Series </th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr class="b"> 
    <td>GOOG </td> 
    <td>[$523, NaN, $524, $600] </td> 
   </tr> 
   <tr class="a"> 
    <td>AAPL </td> 
    <td>[$384, $384, $385, $385] </td> 
   </tr> 
   <tr class="b"> 
    <td>MSFT </td> 
    <td>[$40, $60, NaN, $70] </td> 
   </tr> 
  </tbody> 
 </table> 
 <p>The date-time index defines a mapping of date-times to positions in arrays, and then each record includes a time series represented as an array that conforms to this index.</p> 
</div> 
<div class="section"> 
 <h2 id="Abstractions">Abstractions</h2> 
 <div class="section"> 
  <h3 id="TimeSeriesRDD">TimeSeriesRDD</h3> 
  <p>The central abstraction of the library is the <tt>TimeSeriesRDD</tt>, a lazy distributed collection of univariate series with a conformed time dimension. It is lazy in the sense that it is an RDD: it encapsulates all the information needed to generate its elements, but doesn’t materialize them upon instantiation. It is distributed in the sense that different univariate series within the collection can be stored and processed on different nodes. Within each univariate series, observations are not distributed. The time dimension is conformed in the sense that a single <tt>DateTimeIndex</tt> applies to all the univariate series. Each univariate series within the RDD has a key to identify it. </p> 
  <p>TimeSeriesRDDs then support efficient series-wise operations like slicing, imputing missing values based on surrounding elements, and training time-series models. For example, in Scala:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>val tsRdd: TimeSeriesRDD = ...

// Find a sub-slice between two dates 
val zone = ZoneId.systemDefault()
val subslice = tsRdd.slice(
  ZonedDateTime.of(LocalDateTime.parse(&quot;2015-04-10T00:00:00&quot;), zone)
  ZonedDateTime.of(LocalDateTime.parse(&quot;2015-04-14T00:00:00&quot;), zone))

// Fill in missing values based on linear interpolation
val filled = subslice.fill(&quot;linear&quot;)

// Use an AR(1) model to remove serial correlations
val residuals = filled.mapSeries(series =&gt; ar(series, 1).removeTimeDependentEffects(series))
</pre> 
   </div> 
  </div> 
  <p>Or in Python:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>tsrdd = ...

# Find a sub-slice between two dates
subslice = tsrdd['2015-04-10':'2015-04-14']

# Fill in missing values based on linear interpolation
filled = subslice.fill('linear')
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="DateTimeIndex">DateTimeIndex</h3> 
  <p>The time spanned by a TimeSeriesRDD is encapsulated in a <tt>DateTimeIndex</tt>, which is essentially an ordered collection of timestamps. DateTimeIndexes come in two flavors: uniform and irregular. Uniform DateTimeIndexes have a concise representation including a start date, a frequency (i.e. the interval between two timestamps), and a number of periods. Irregular indices are simply represented by an ordered collection of timestamps.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#user_guide" title="User Guide">User Guide <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Terminology" title="Terminology">Terminology</a>
		<li><a href="#Laying_Out_Time_Series_Data" title="Laying Out Time Series Data">Laying Out Time Series Data</a>
		<li class="dropdown"><a href="#Abstractions" title="Abstractions">Abstractions <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#TimeSeriesRDD" title="TimeSeriesRDD">TimeSeriesRDD</a>
		<li><a href="#DateTimeIndex" title="DateTimeIndex">DateTimeIndex</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2016. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
